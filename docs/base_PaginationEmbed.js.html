<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>base/PaginationEmbed.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Embeds.html">Embeds</a><ul class='methods'><li data-type='method'><a href="Embeds.html#addBlankField">addBlankField</a></li><li data-type='method'><a href="Embeds.html#addField">addField</a></li><li data-type='method'><a href="Embeds.html#build">build</a></li><li data-type='method'><a href="Embeds.html#setArray">setArray</a></li><li data-type='method'><a href="Embeds.html#setAuthor">setAuthor</a></li><li data-type='method'><a href="Embeds.html#setAuthorizedUser">setAuthorizedUser</a></li><li data-type='method'><a href="Embeds.html#setChannel">setChannel</a></li><li data-type='method'><a href="Embeds.html#setClientMessage">setClientMessage</a></li><li data-type='method'><a href="Embeds.html#setColor">setColor</a></li><li data-type='method'><a href="Embeds.html#setDescription">setDescription</a></li><li data-type='method'><a href="Embeds.html#setEmojis">setEmojis</a></li><li data-type='method'><a href="Embeds.html#setFooter">setFooter</a></li><li data-type='method'><a href="Embeds.html#setImage">setImage</a></li><li data-type='method'><a href="Embeds.html#setPage">setPage</a></li><li data-type='method'><a href="Embeds.html#setThumbnail">setThumbnail</a></li><li data-type='method'><a href="Embeds.html#setTimeout">setTimeout</a></li><li data-type='method'><a href="Embeds.html#setTimestamp">setTimestamp</a></li><li data-type='method'><a href="Embeds.html#setTitle">setTitle</a></li><li data-type='method'><a href="Embeds.html#setURL">setURL</a></li><li data-type='method'><a href="Embeds.html#showPageIndicator">showPageIndicator</a></li></ul></li><li><a href="FieldsEmbed.html">FieldsEmbed</a><ul class='methods'><li data-type='method'><a href="FieldsEmbed.html#build">build</a></li><li data-type='method'><a href="FieldsEmbed.html#formatField">formatField</a></li><li data-type='method'><a href="FieldsEmbed.html#setArray">setArray</a></li><li data-type='method'><a href="FieldsEmbed.html#setAuthorizedUser">setAuthorizedUser</a></li><li data-type='method'><a href="FieldsEmbed.html#setChannel">setChannel</a></li><li data-type='method'><a href="FieldsEmbed.html#setClientMessage">setClientMessage</a></li><li data-type='method'><a href="FieldsEmbed.html#setElementsPerPage">setElementsPerPage</a></li><li data-type='method'><a href="FieldsEmbed.html#setEmojis">setEmojis</a></li><li data-type='method'><a href="FieldsEmbed.html#setPage">setPage</a></li><li data-type='method'><a href="FieldsEmbed.html#setTimeout">setTimeout</a></li><li data-type='method'><a href="FieldsEmbed.html#showPageIndicator">showPageIndicator</a></li></ul></li><li><a href="PaginationEmbed.html">PaginationEmbed</a><ul class='methods'><li data-type='method'><a href="PaginationEmbed.html#setArray">setArray</a></li><li data-type='method'><a href="PaginationEmbed.html#setAuthorizedUser">setAuthorizedUser</a></li><li data-type='method'><a href="PaginationEmbed.html#setChannel">setChannel</a></li><li data-type='method'><a href="PaginationEmbed.html#setClientMessage">setClientMessage</a></li><li data-type='method'><a href="PaginationEmbed.html#setEmojis">setEmojis</a></li><li data-type='method'><a href="PaginationEmbed.html#setPage">setPage</a></li><li data-type='method'><a href="PaginationEmbed.html#setTimeout">setTimeout</a></li><li data-type='method'><a href="PaginationEmbed.html#showPageIndicator">showPageIndicator</a></li></ul></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<div id="main">
    
    <h1 class="page-title">base/PaginationEmbed.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const { RichEmbed } = require('discord.js');

/**
 * @extends {RichEmbed}
 */
class PaginationEmbed extends RichEmbed {

  /**
   * Options for PaginationEmbed.clientMessage.
   * @typedef {Object} ClientMessageOptions
   * @property {Message} [message=null] - The message object sent by the client, if there is any.
   * @property {string} [content='Preparing...'] - The custom message content while preparing the embed.
   */

  /**
   * Options for PaginationEmbed.emojis.
   * @typedef {Object} NavigationButtons
   * @property {string} [back='â—€'] - The back button.
   * @property {string} [jump='â†—'] - The jump button.
   * @property {string} [forward='â–¶'] - The forward button.
   * @property {string} [delete='ðŸ—‘'] - The delete button.
   */

  /**
   * Options for the constructor.
   * @typedef {Object} PaginationEmbedOptions
   * @property {User} [authorizedUser=null] - The authorized user to navigate the pages.
   * @property {TextChannel} channel - The channel where to send the embed.
   * @property {ClientMessageOptions} [clientMessage=null] - Settings for the message sent by the client.
   * @property {Array.&lt;*>} array - An array of elements to paginate.
   * @property {boolean} [pageIndicator=true] - Whether page number indicator on client's message is shown or not.
   * @property {number|string} [page=1] - Jumps to a certain page upon PaginationEmbed.build().
   * @property {number} [timeout=30000] - The time for awaiting a user action before timeout in ms.
   * @property {NavigationButtons} [emojis={back:'â—€',jump:'â†—',forward:'â–¶',delete:'ðŸ—‘'}] - The emojis used for navigation buttons.
   */

  /**
   * @param {PaginationEmbedOptions} [options={}] Options for PaginationEmbed.
   */
  constructor(options = {}) {
    if (!(options instanceof Object)) throw new Error('Cannot invoke PaginationEmbed class without an actual options object.');

    super(options);

    /**
     * The authorized user to navigate the pages.
     * @type {User}
     */
    this.authorizedUser = options.authorizedUser || null;

    /**
     * The channel where to send the embed.
     * @type {TextChannel}
     */
    this.channel = options.channel || null;

    /**
     * Settings for the message sent by the client.
     * @type {ClientMessageOptions}
     */
    this.clientMessage = options.clientMessage || { message: null, content: null };

    /**
     * An array of elements to paginate.
     * @type {Array.&lt;*>}
     */
    this.array = options.array || [];

    /**
     * Whether page number indicator on client's message is shown or not.
     * @type {boolean}
     */
    this.pageIndicator = options.pageIndicator || true;

    /**
     * Jumps to a certain page upon PaginationEmbed.build().
     * @type {number|string}
     */
    this.page = options.page || 1;

    /**
     * The time for awaiting a user action before timeout in ms.
     * @type {number}
     */
    this.timeout = options.timeout || 30000;

    /**
     * The emojis used for navigation buttons.
     * @type {NavigationButtons}
     */
    this.emojis = options.emojis || {
      back: 'â—€',
      jump: 'â†—',
      forward: 'â–¶',
      delete: 'ðŸ—‘'
    };

    /**
     * Number of pages for this instance.
     * @type {number}
     * @private
     */
    this.pages = null;
  }

  build() {
    throw new Error('Cannot invoke this class. Invoke with [pagination/Embeds] or [pagination/FieldsEmbed] instead.');
  }

  /**
   * Sets the array of elements to paginate.
   * @param {Array} array - An array of elements to paginate.
   * @returns {PaginationEmbed}
   */
  setArray(array) {
    const isValidArray = Array.isArray(array) &amp;&amp; Boolean(array.length);

    if (!isValidArray) throw new Error('Cannot invoke PaginationEmbed class without initialising the array to paginate.');

    this.array = array;

    return this;
  }

  /**
   * Set the authorized person to navigate the pages.
   * @param {User} user - The user object.
   * @returns {PaginationEmbed}
   */
  setAuthorizedUser(user) {
    this.authorizedUser = user;

    return this;
  }

  /**
   * The channel where to send the embed.
   * @param {TextChannel} channel - The channel object.
   * @returns {PaginationEmbed}
   */
  setChannel(channel) {
    this.channel = channel;

    return this;
  }

  /**
   * Sets the settings for the message sent by the client.
   * @param {Message} message - The message object sent by the client.
   * @param {string} [content='Preparing...'] - The custom message content while preparing the embed.
   * @returns {PaginationEmbed}
   */
  setClientMessage(message, content = null) {
    if (!content) content = 'Preparing...';

    Object.assign(this.clientMessage, { message, content });

    return this;
  }

  /**
   * Sets the emojis used for navigation buttons.
   * @param {NavigationButtons} emojis - An object containing customised emojis to use as navigation buttons.
   * @returns {PaginationEmbed}
   */
  setEmojis(emojis) {
    Object.assign(this.emojis, emojis);

    return this;
  }

  /**
   * Sets to jump to a certain page upon calling PaginationEmbed.build().
   * @param {number|string} param - The page number to jump to. As String: 'back', 'forward'
   * @returns {PaginationEmbed}
   */
  setPage(param) {
    const isString = typeof param === 'string';

    if (!(!isNaN(param) || isString)) throw new Error('setPage() only accepts number/string type.');

    const navigator = param === 'back'
      ? this.page === 1 ? this.page : this.page - 1
      : this.page === this.pages ? this.pages : this.page + 1;

    this.page = isString ? navigator : param;

    return this;
  }

  /**
   * Sets the time for awaiting a user action before timeout in ms.
   * @param {number} timeout Timeout value in ms.
   * @returns {PaginationEmbed}
   */
  setTimeout(timeout) {
    if (typeof timeout !== 'number') throw new Error('setTimeout() only accepts number type.');

    this.timeout = timeout;

    return this;
  }

  /**
   * Sets whether page number indicator on client's message is shown or not.
   * @param {boolean} boolean - Show page indicator?
   * @returns {PaginationEmbed}
   */
  showPageIndicator(boolean) {
    if (typeof boolean !== 'boolean') throw new Error('showPageIndicator() only accepts boolean type.');

    this.pageIndicator = boolean;

    return this;
  }

  /**
   * Evaluates the constructor and the client.
   * @private
   * @param {number} pages - The number of pages in this instance.
   */
  async _verify(pages) {
    this
      .setChannel(this.channel)
      .setAuthorizedUser(this.authorizedUser)
      .setClientMessage(this.clientMessage.message, this.clientMessage.content)
      .setArray(this.array)
      .showPageIndicator(this.pageIndicator)
      .setTimeout(this.timeout)
      .setEmojis(this.emojis);

    this.pages = pages;
    this.setPage(this.page);

    if (!(this.page >= 1 &amp;&amp; this.page &lt;= this.pages)) throw new Error('Invalid page.');

    const message = this.clientMessage.message
      ? await this.clientMessage.message.edit(this.clientMessage.content)
      : await this.channel.send(this.clientMessage.content);
    this.setClientMessage(message, this.clientMessage.content);

    const permissions = ['ADD_REACTIONS', 'MANAGE_MESSAGES', 'EMBED_LINKS'];
    const missing = message.channel.permissionsFor(message.client.user).missing(permissions);

    if (missing.length)
      throw new Error(`Cannot invoke PaginationEmbed class without required permissions: ${missing.join(', ')}`);
  }

  /**
   * Deploys emoji reacts for the message sent by the client.
   * @private
   */
  async _drawNavigation() {
    if (this.pages > 1) await this.clientMessage.message.react(this.emojis.back);
    if (this.pages > 2) await this.clientMessage.message.react(this.emojis.jump);
    if (this.pages > 1) await this.clientMessage.message.react(this.emojis.forward);

    await this.clientMessage.message.react(this.emojis.delete);

    this._awaitResponse();
  }

  /**
   * Helper for intialising the RichEmbed.
   * [For sub-class] Initialises the RichEmbed.
   * @private
   * @param {boolean} [callNavigation=true] - Whether to call _drawNavigation() or not.
   */
  _loadList(callNavigation = true) {
    if (callNavigation) return this._drawNavigation();
  }

  /**
   * Calls PaginationEmbed.setPage().
   * @private
   * @param {number} param - The page number to jump to. As String: 'back', 'forward'
   */
  async _loadPage(param = 1) {
    this.setPage(param);
    await this._loadList(false);

    this._awaitResponse();
  }

  /**
   * Awaits the reaction from the user.
   * @private
   */
  async _awaitResponse() {
    const emojis = Object.values(this.emojis);
    const filter = (r, u) => {
      if (this.authorizedUser)
        return u.id === this.authorizedUser.id &amp;&amp; emojis.includes(r.emoji.name);

      return !u.bot &amp;&amp; emojis.includes(r.emoji.name);
    };
    const clientMessage = this.clientMessage.message;

    try {
      const responses = await clientMessage.awaitReactions(filter, { max: 1, time: this.timeout, errors: ['time'] });
      const response = responses.first();
      const user = response.users.last();
      const emoji = response.emoji.name;

      if (emoji === this.emojis.delete) return clientMessage.delete();

      await response.remove(user);

      switch (emoji) {
        case this.emojis.back:
          if (this.page === 1) return this._awaitResponse();

          this._loadPage('back');
          break;

        case this.emojis.jump:
          if (this.pages &lt;= 2) return this._awaitResponse();

          this._awaitResponseEx(user);
          break;

        case this.emojis.forward:
          if (this.page === this.pages) return this._awaitResponse();

          this._loadPage('forward');
          break;
      }
    } catch (c) {
      await clientMessage.clearReactions();

      if (c instanceof Error) throw c;
    }
  }

  /**
   * Awaits the custom page input from the user.
   * @private
   * @param {User} user - The user who reacted to jump on a certain page.
   */
  async _awaitResponseEx(user) {
    const cancel = ['0', 'cancel'];
    const filter = m => {
      const supposedPage = parseInt(m.content);

      return (
        m.author.id === user.id &amp;&amp; (
          (!isNaN(m.content) &amp;&amp; supposedPage !== this.page &amp;&amp; supposedPage >= 1 &amp;&amp; supposedPage &lt;= this.pages) ||
          cancel.includes(m.content.toLowerCase())
        )
      );
    };
    const channel = this.clientMessage.message.channel;
    const prompt = await channel.send(`${user.toString()}, To what page would you like to jump? Say \`cancel\` or \`0\` to cancel the prompt.`);

    try {
      const responses = await channel.awaitMessages(filter, { max: 1, time: this.timeout, errors: ['time'] });
      const response = responses.first();
      const content = response.content;

      await prompt.delete();
      await response.delete();

      if (cancel.includes(content)) return this._awaitResponse();

      this._loadPage(parseInt(content));
    } catch (c) {
      await prompt.delete();

      if (c instanceof Error) throw c;
    }
  }
}

module.exports = PaginationEmbed;
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Wed Jun 13 2018 19:37:35 GMT+0800 (Malay Peninsula Standard Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
